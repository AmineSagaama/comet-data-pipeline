<div class="home-page page-content">
	<div class="container-fluid">
		<div class="px-5 pb-4 text-center rtElementsContainer">
			<div class="row">
				<div class="col-lg-12">
					<div pDraggable="rts" (onDragStart)="dragStart($event, rt)" (onDragEnd)="dragEnd($event)" (click)="openListServers(rt.id)"
						class="rtElement mt-3 mr-3 px-3 py-2" id="tagElement-{{rt.id}}" [style.background-color]="rt.color" *ngFor="let rt of resourceTypes; let i = index" pTooltip="{{rt.name}}" tooltipPosition="top" tooltipZIndex="1600">{{rt.id}}<i class="fa fa-arrows"></i></div>
				</div>
			</div>
		</div>
		<div class="row mb-4">
			<div class="col-lg-12">
				<p-table #dt [autoLayout]="true" [value]="servers">
					<ng-template pTemplate="caption">
						<div class="table-caption">
							<div class="filter">
								<i class="fa fa-search"></i>
								<input type="text" class="filter-input" placeholder="Filter by name" (input)="dt.filter($event.target.value, 'name', 'contains')"/>
							</div>
							List Of Servers
						</div>
					</ng-template>
					<ng-template pTemplate="header">
						<tr>
							<th>
								Server Name <i class="pull-right pointer fa fa-plus-circle fa-2x" (click)="showAddServer = true"></i>
							</th>
							<th>Resource Types</th>
						</tr>
					</ng-template>
					<ng-template pTemplate="body" let-server>
						<tr>
							<td>{{server.name}}</td>
							<td pDroppable="rts" (onDragEnter)="dragEnter($event)" (onDragLeave)="dragLeave($event)" (onDrop)="drop($event)" [ngClass]="{'empty': server.rts.length == 0}" [attr.data-server-id] = "server.id">
								<div class="rtListContainer" *ngFor="let rt of server.rts">
									<div class="rtListElement my-2 mr-3 pl-3 py-1" [style.background-color]="rt.tag.color" pTooltip="{{rt.tag.name}}" tooltipPosition="top" tooltipZIndex="1600">{{rt.tag.id}}</div>
									<i class="fa fa-times" (click)="deleteResourceType(rt.id, server.id)"></i>
								</div>
							</td>
						</tr>
					</ng-template>
				</p-table>
			</div>
		</div>
	</div>
</div>

<p-dialog header="Error adding Tag" [(visible)]="showErrorDialog" [modal]="true" [responsive]="true" [width]="500"  [resizable]="false" [focusOnShow]="false" (onHide)="closeErrorDialog()">
	<div>{{errorMessage}}</div>
	<p-footer>
		<button type="button" class="btn btn-outline-secondary" (click)="closeErrorDialog()">Close</button>
	</p-footer>
</p-dialog>

<p-dialog header="Add New Server" [(visible)]="showAddServer" [modal]="true" [responsive]="true" [width]="500"  [resizable]="false" [focusOnShow]="false" (onHide)="closeNewServerForm()">
    <div class="mt-3">
		<form [formGroup]="newServerForm">
			<input type="text" [ngClass]="['form-control', getValidity(newServerNameCtl)]" formControlName="name" placeholder="Server Name"/>
			<small *ngIf="newServerNameCtl && newServerNameCtl.invalid && newServerNameCtl.dirty" class="error">
				Ce champs est requis
			</small>
		</form>
	</div>
	<p-footer>
		<button type="button" class="btn btn-secondary" (click)="closeNewServerForm()">Cancel</button>
		<button type="button" class="btn btn-primary ml-2" (click)="addNewServer()">Save</button>
	</p-footer>
</p-dialog>

<list-servers-dialog
			[servers]="servers"
			[tagId]="selectedTagId"
			[visible]="showListServers"
			(onSubmit)="saveListServers($event)"
			(onClose)="closeListServers()"></list-servers-dialog>

<resource-type-details
			[servers]="servers"
			[serverId]="selectedServerId"
			[resourceType]="selectedResourceType"
			[visible]="showResourceTypeDialog"
			(onSubmit)="saveResourceType($event)"
			(onClose)="closeResourceType()"></resource-type-details>